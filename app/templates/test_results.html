{% extends "base.html" %}
{% block title %}Результаты тестов{% endblock %}
{% block content %}
<h3>Результаты тестов</h3>

<label>Факультет:</label>
<select id="faculty_filter">
    <option value="">Все факультеты</option>
    {% for faculty in faculties %}
        <option value="{{ faculty.id }}">{{ faculty.name }}</option>
    {% endfor %}
</select>

<label>Группа:</label>
<select id="group_filter">
    <option value="">Все группы</option>
    {% for group in groups %}
        <option value="{{ group.id }}" data-faculty="{{ group.faculty_id }}">{{ group.name }}</option>
    {% endfor %}
</select>

<hr>

<h4>Сдавшие тест</h4>
<div id="results_container" class="cards-container">
    {% for result in test_results %}
        <div class="student-card" data-group="{{ result.student.group_id }}"
             data-faculty="{{ result.student.group.faculty_id }}"
             onclick="openModal({{ result.id }})">
            <h4>{{ result.student.full_name }}</h4>
            <p><strong>Тест:</strong> {{ result.test.title }}</p>
            <p><strong>Оценка:</strong> {{ result.grade if result.grade else "Не оценено" }}</p>
        </div>
    {% endfor %}

</div>

<div id="testModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3 id="testTitle"></h3>
        <div id="modalBody"></div>
        <form id="gradeForm" onsubmit="submitGrade(event)">
            <label>Оценка:</label>
            <input type="number" id="gradeInput" min="1" max="10" required>
            <label>Комментарий:</label>
            <textarea id="commentInput"></textarea>
            <input type="hidden" id="resultId">
            <button type="submit">Сохранить</button>
        </form>
    </div>
</div>

<a href="{{ url_for('main.dashboard') }}">Назад к кабинету</a>
<script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}
